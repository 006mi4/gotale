<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restarting - Hytale Server Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800;900&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="app-shell">
        <div class="bg-noise"></div>
        <div class="container" style="min-height: 70vh; display: flex; align-items: center; justify-content: center;">
            <div class="showcase-box" style="text-align: center; max-width: 520px;">
                <h2 style="color: white; margin-bottom: 12px;">Restarting Web Interface</h2>
                <p class="muted" id="restartStatus">Please wait while the web interface restarts.</p>
                <div style="margin-top: 18px;">
                    <div class="loading-spinner" style="width: 46px; height: 46px; border: 4px solid var(--border-highlight); border-top: 4px solid var(--gold-main); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                </div>
                <div class="muted" style="margin-top: 18px;">If this takes too long, reload the page.</div>
            </div>
        </div>
    </div>
    {% include 'footer.html' %}
    <script>
        (function() {
            const statusEl = document.getElementById('restartStatus');
            let attempts = 0;
            const maxAttempts = 90;

            const poll = async () => {
                attempts += 1;
                try {
                    const response = await fetch('/api/system/health', { cache: 'no-store' });
                    if (response.ok || [401, 403, 302].includes(response.status)) {
                        window.location.href = '/login';
                        return;
                    }
                } catch (error) {
                    // Expected during restart.
                }

                if (attempts >= maxAttempts) {
                    statusEl.textContent = 'Restart is taking longer than expected. Please reload the page.';
                    return;
                }
                setTimeout(poll, 2000);
            };

            setTimeout(poll, 1500);
        })();
    </script>
</body>
</html>
